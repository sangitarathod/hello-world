/*
Part of the WordPress plugin Tag Groups
Plugin URI: https://chattymango.com/tag-groups/
Author: Christoph Amthor
License: GNU GENERAL PUBLIC LICENSE, Version 3
Last modified: 20180119
*/
function tg_do_ajax(t,a,e){var s={action:"tg_ajax_manage_groups",nonce:jQuery("#tg_nonce").val()};jQuery.extend(a,s),a.start_position=jQuery("#tg_start_position").val();var n="";jQuery.ajax({url:t.ajaxurl,data:a,dataType:"xml",method:"post",success:function(s){var o=jQuery(s).find("response_data").text(),l=jQuery(s).find("supplemental message").text(),r=jQuery(s).find("supplemental nonce").text(),d=jQuery(s).find("supplemental task").text();if(""!==r&&jQuery("#tg_nonce").val(r),"success"===o){var p=JSON.parse(jQuery(s).find("groups").text()),c=jQuery(s).find("start_position").text();""!==c?jQuery("#tg_start_position").val(c):c=a.start_position;jQuery(s).find("end_position").text();var _=jQuery(s).find("max_number").text(),u="",g=c;if(_>0)for(var h in p){var f=p[h];null!=f.id&&(u+='<tr class="tg_sort_tr" data-position="'+g+'">\n',u+="<td>"+f.id+"</td>\n",u+='<td><span class="tg_edit_label tg_text" data-position="'+g+'" data-label="'+escape_html(f.label)+'">'+escape_html(f.label)+'<span class="dashicons dashicons-edit tg_pointer" style="display:none;"></span></span></td>\n',u+='<td><div class="tg_term_amounts">',""!==t.tagsurl?u+='<a href="'+t.tagsurl+"&term-filter="+f.id+'" title="'+e.tooltip_showtags+'">'+f.amount+"</a>":u+=f.amount,u+="</div>",""!==t.postsurl&&(u+='<a href="'+t.postsurl+"&post_status=all&tg_filter_posts_value="+f.id+'" title="'+e.tooltip_showposts+'"><span class="tg_pointer dashicons dashicons-admin-page"></span></a>'),u+="</td>\n<td>",u+='<span class="tg_delete tg_pointer dashicons dashicons-trash" data-position="'+g+'" title="'+e.tooltip_delete+'"></span>',u+='<span class="tg_pointer dashicons dashicons-plus-alt" title="'+e.tooltip_newbelow+'" onclick="tg_toggle_clear('+g+')" style="margin-left:5px;"></span>',u+="</td>\n",u+="<td>",u+='<div style="overflow:hidden; position:relative; height:20px; clear:both;">',g>1&&(u+='<span class="tg_up tg_pointer dashicons dashicons-arrow-up" data-position="'+g+'" title="'+e.tooltip_move_up+'" style="font-size:30px;"></span>'),u+="</div>",u+='<div style="overflow:hidden; position:relative; height:20px; clear:both;">',g<_&&(u+='<span class="tg_down tg_pointer dashicons dashicons-arrow-down" data-position="'+g+'" title="'+e.tooltip_move_down+'" style="font-size:30px;"></span>'),u+="</div>",u+="</td>\n",u+="</tr>\n",u+='<tr style="display:none; height:45px; background-color:#FFC;" id="tg_new_'+g+'">\n',u+='<td style="display:none;">'+e.newgroup+"</td>\n",u+='<td colspan="4" style="display:none;"><input data-position="'+g+'"  placeholder="'+e.placeholder_new+'">',u+='<span class="tg_new_yes dashicons dashicons-yes tg_pointer" data-position="'+g+'"></span> <span class="tg_new_no dashicons dashicons-no-alt tg_pointer" data-position="'+g+'" onclick="tg_toggle_clear('+g+')"></span>',u+="</td>\n",u+="</tr>\n",g++)}else u+='<tr id="tg_new_1">\n',u+="<td ></td>\n",u+='<td colspan="4"><input data-position="1" placeholder="'+e.newgroup+'">',u+='<span class="tg_new_yes dashicons dashicons-yes tg_pointer" data-id="1"></span></span>',u+="</td>\n",u+="</tr>\n";"move"==d?jQuery("#tg_groups_container").html(u):jQuery("#tg_groups_container").fadeOut(300,function(){jQuery(this).html(u).fadeIn(500)});var y,b,m="",v=Number(t.items_per_page);for(v<1&&(v=1),b=Math.floor(c/v)+1,max_page=Math.floor((_-1)/v)+1,m+=b>1?'<button class="button-secondary tg_pager_button" data-page="'+(b-1)+'"><span class="dashicons dashicons-arrow-left-alt2"></span></button>':'<button class="button-secondary tg_pager_button" disabled><span class="dashicons dashicons-arrow-left-alt2"></span></button>',i=1;i<=_;i+=v)y=Math.floor(i/v)+1,m+=y==b?'<button class="tg_reload_button tg_pointer button-secondary" id="tg_groups_reload" title="'+e.tooltip_reload+'"><span class="dashicons dashicons-update"></span></button>':'<button class="button-secondary tg_pager_button" data-page="'+y+'"><span>'+y+"</span></button>";b<max_page?m+='<button class="button-secondary tg_pager_button" data-page="'+(b+1)+'"><span class="dashicons dashicons-arrow-right-alt2"></span></button>':m+='<button class="button-secondary tg_pager_button" disabled><span class="dashicons dashicons-arrow-right-alt2"></span></button>',jQuery("#tg_pager_container").fadeOut(200,function(){jQuery(this).html(m).fadeIn(400,function(){jQuery("#tg_pager_container_adjuster").css({height:Number(jQuery("#tg_pager_container").height())+10})})}),""!=l&&(n+='<div class="notice notice-success is-dismissible"><p>'+l+'</p></div><br clear="all" />'),jQuery("#tg_message_container").fadeOut(500,function(){jQuery(this).html(n).fadeIn(800)})}else""==l&&(l="Error loading data.",console.log(s)),n+='<div class="notice notice-error is-dismissible"><p>'+l+'</p></div><br clear="all" />',jQuery("#tg_message_container").fadeOut(500,function(){jQuery(this).html(n).fadeIn(800)})},error:function(t,a,e){console.log("Tag Groups error: "+t.responseText)}})}function tg_close_textfield(t,a){var e,s=t.children(":first").attr("data-position");e=escape_html(a?t.children(":first").attr("value"):t.children(":first").attr("data-label")),t.replaceWith('<span class="tg_edit_label tg_text" data-position="'+s+'" data-label="'+e+'">'+e+' <span class="dashicons dashicons-edit tg_pointer" style="display:none;"></span></span>')}function tg_toggle_clear(t){var a=jQuery("#tg_new_"+t);a.is(":visible")?(jQuery("[data-position="+t+"]").val(""),a.children().fadeOut(300,function(){a.slideUp(600)})):(jQuery('[id^="tg_new_"]:visible').children().fadeOut(300,function(){jQuery('[id^="tg_new_"]:visible').slideUp(400)}),a.delay(800).slideDown(400,function(){a.children().fadeIn(300)}))}function tg_close_all_textfields(){jQuery(".tg_edit_label_active").each(function(){tg_close_textfield(jQuery(this),!1)})}function escape_html(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}
